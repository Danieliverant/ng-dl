const UNSIGNED_INTEGER_REGEX = '^[0-9]*$';
const SIGNED_DOUBLE_REGEX = '^-?[0-9]+(.[0-9]+)?$';
const NUMBERS_REGEX = /\d/g;
const CHROME_MIN_VALIDATION_MESSAGE = 'Value must be greater than or equal to';
const CHROME_MAX_VALIDATION_MESSAGE = 'Value must be less than or equal to';
const actionKeys = ['a', 'c', 'v', 'x'];
const defaultAllowedKeys = [
    'Backspace',
    'ArrowLeft',
    'ArrowRight',
    'Escape',
    'Tab',
];
export function overrideInputType(input) {
    // checking new ci.
    input.setAttribute('type', 'text');
    input.setAttribute('inputmode', 'decimal');
    input.removeAttribute('pattern');
}
export function getFormattedValue(value, decimalSeparator, thousandsSeparator) {
    return Number(parseValue(value, decimalSeparator, thousandsSeparator).replace(decimalSeparator, '.'));
}
export function isAllowedKey(e, decimalSeparators) {
    const key = getKeyName(e);
    const allowedKeys = getAllowedKeys(e, decimalSeparators);
    return (allowedKeys.includes(key) ||
        (actionKeys.includes(key) && isActionKey(e)) ||
        isNumberKey(e));
}
export function validate(el, value, min, max) {
    if (value < min) {
        el.setCustomValidity(`${CHROME_MIN_VALIDATION_MESSAGE} ${min}.`);
        return false;
    }
    if (value > max) {
        el.setCustomValidity(`${CHROME_MAX_VALIDATION_MESSAGE} ${max}.`);
        return false;
    }
    el.setCustomValidity('');
    return true;
}
/**
 * support for old browsers.
 */
function mapKeyCodeToKeyName(keyCode) {
    if (keyCode && String.fromCharCode) {
        switch (keyCode) {
            case 8:
                return 'Backspace';
            case 9:
                return 'Tab';
            case 27:
                return 'Escape';
            case 37:
                return 'ArrowLeft';
            case 39:
                return 'ArrowRight';
            case 188:
                return ',';
            case 190:
                return '.';
            case 109:
            case 173:
            case 189:
                return '-';
            default:
                return String.fromCharCode(keyCode);
        }
    }
    return '';
}
function parseValue(value, decimalSeparator, thousandSeparator) {
    value = replaceDecimalSeparator(value, decimalSeparator);
    value = appendZeroToDecimal(value, decimalSeparator);
    value = removeThousandsSeparator(value, thousandSeparator);
    const isValid = new RegExp(SIGNED_DOUBLE_REGEX).test(value);
    return isValid ? value : '0';
}
function replaceDecimalSeparator(value, decimalSeparator) {
    const separator = value.replace('-', '').replace(NUMBERS_REGEX, '');
    return value.replace(separator || decimalSeparator, decimalSeparator);
}
function appendZeroToDecimal(value, decimalSeparator) {
    const firstCharacter = value.charAt(0);
    if (firstCharacter === decimalSeparator) {
        return 0 + value;
    }
    const lastCharacter = value.charAt(value.length - 1);
    if (lastCharacter === decimalSeparator) {
        return value + 0;
    }
    return value;
}
function removeThousandsSeparator(value, thousandsSeparator) {
    return value.replace(thousandsSeparator, '');
}
function isActionKey(e) {
    return e.ctrlKey || e.metaKey;
}
function getKeyName(e) {
    return e.key || mapKeyCodeToKeyName(e.keyCode);
}
function isNumberKey(e) {
    const key = getKeyName(e);
    return new RegExp(UNSIGNED_INTEGER_REGEX).test(key);
}
function getAllowedKeys(e, decimalSeparators) {
    const originalValue = e.target.value;
    const cursorPosition = e.target.selectionStart || 0;
    const signExists = originalValue.includes('-');
    const separatorExists = decimalSeparators.some((separator) => originalValue.includes(separator));
    const separatorIsCloseToSign = signExists && cursorPosition <= 1;
    if (!separatorIsCloseToSign && !separatorExists) {
        defaultAllowedKeys.push(...decimalSeparators);
    }
    const firstCharacterIsSeparator = decimalSeparators.some((separator) => originalValue.charAt(0) === separator);
    if (!signExists && !firstCharacterIsSeparator && cursorPosition === 0) {
        defaultAllowedKeys.push('-');
    }
    return defaultAllowedKeys;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibnVtZXJpYy1pbnB1dC51dGlscy5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS90cmF2aXMvYnVpbGQvRGFuaWVsaXZlcmFudC9uZy1kbC9wcm9qZWN0cy9udW1lcmljLWlucHV0L3NyYy8iLCJzb3VyY2VzIjpbImxpYi9udW1lcmljLWlucHV0LnV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sc0JBQXNCLEdBQUcsVUFBVSxDQUFDO0FBQzFDLE1BQU0sbUJBQW1CLEdBQUcsc0JBQXNCLENBQUM7QUFDbkQsTUFBTSxhQUFhLEdBQUcsS0FBSyxDQUFDO0FBQzVCLE1BQU0sNkJBQTZCLEdBQUcsd0NBQXdDLENBQUM7QUFDL0UsTUFBTSw2QkFBNkIsR0FBRyxxQ0FBcUMsQ0FBQztBQUM1RSxNQUFNLFVBQVUsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBQ3hDLE1BQU0sa0JBQWtCLEdBQUc7SUFDekIsV0FBVztJQUNYLFdBQVc7SUFDWCxZQUFZO0lBQ1osUUFBUTtJQUNSLEtBQUs7Q0FDTixDQUFDO0FBRUYsTUFBTSxVQUFVLGlCQUFpQixDQUFDLEtBQXVCO0lBQ3ZELG1CQUFtQjtJQUNuQixLQUFLLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNuQyxLQUFLLENBQUMsWUFBWSxDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUMsQ0FBQztJQUMzQyxLQUFLLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ25DLENBQUM7QUFFRCxNQUFNLFVBQVUsaUJBQWlCLENBQy9CLEtBQWEsRUFDYixnQkFBd0IsRUFDeEIsa0JBQTBCO0lBRTFCLE9BQU8sTUFBTSxDQUNYLFVBQVUsQ0FBQyxLQUFLLEVBQUUsZ0JBQWdCLEVBQUUsa0JBQWtCLENBQUMsQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxDQUFDLENBQ3ZGLENBQUM7QUFDSixDQUFDO0FBRUQsTUFBTSxVQUFVLFlBQVksQ0FDMUIsQ0FBZ0IsRUFDaEIsaUJBQTJCO0lBRTNCLE1BQU0sR0FBRyxHQUFXLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNsQyxNQUFNLFdBQVcsR0FBRyxjQUFjLENBQUMsQ0FBQyxFQUFFLGlCQUFpQixDQUFDLENBQUM7SUFDekQsT0FBTyxDQUNMLFdBQVcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDO1FBQ3pCLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDNUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUNmLENBQUM7QUFDSixDQUFDO0FBRUQsTUFBTSxVQUFVLFFBQVEsQ0FDdEIsRUFBb0IsRUFDcEIsS0FBYSxFQUNiLEdBQVksRUFDWixHQUFZO0lBRVosSUFBSSxLQUFLLEdBQUcsR0FBRyxFQUFFO1FBQ2YsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsNkJBQTZCLElBQUksR0FBRyxHQUFHLENBQUMsQ0FBQztRQUNqRSxPQUFPLEtBQUssQ0FBQztLQUNkO0lBRUQsSUFBSSxLQUFLLEdBQUcsR0FBRyxFQUFFO1FBQ2YsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsNkJBQTZCLElBQUksR0FBRyxHQUFHLENBQUMsQ0FBQztRQUNqRSxPQUFPLEtBQUssQ0FBQztLQUNkO0lBRUQsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3pCLE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUVEOztHQUVHO0FBQ0gsU0FBUyxtQkFBbUIsQ0FBQyxPQUFlO0lBQzFDLElBQUksT0FBTyxJQUFJLE1BQU0sQ0FBQyxZQUFZLEVBQUU7UUFDbEMsUUFBUSxPQUFPLEVBQUU7WUFDZixLQUFLLENBQUM7Z0JBQ0osT0FBTyxXQUFXLENBQUM7WUFDckIsS0FBSyxDQUFDO2dCQUNKLE9BQU8sS0FBSyxDQUFDO1lBQ2YsS0FBSyxFQUFFO2dCQUNMLE9BQU8sUUFBUSxDQUFDO1lBQ2xCLEtBQUssRUFBRTtnQkFDTCxPQUFPLFdBQVcsQ0FBQztZQUNyQixLQUFLLEVBQUU7Z0JBQ0wsT0FBTyxZQUFZLENBQUM7WUFDdEIsS0FBSyxHQUFHO2dCQUNOLE9BQU8sR0FBRyxDQUFDO1lBQ2IsS0FBSyxHQUFHO2dCQUNOLE9BQU8sR0FBRyxDQUFDO1lBQ2IsS0FBSyxHQUFHLENBQUM7WUFDVCxLQUFLLEdBQUcsQ0FBQztZQUNULEtBQUssR0FBRztnQkFDTixPQUFPLEdBQUcsQ0FBQztZQUNiO2dCQUNFLE9BQU8sTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUN2QztLQUNGO0lBQ0QsT0FBTyxFQUFFLENBQUM7QUFDWixDQUFDO0FBRUQsU0FBUyxVQUFVLENBQUMsS0FBYSxFQUFFLGdCQUF3QixFQUFFLGlCQUF5QjtJQUNwRixLQUFLLEdBQUcsdUJBQXVCLENBQUMsS0FBSyxFQUFFLGdCQUFnQixDQUFDLENBQUM7SUFDekQsS0FBSyxHQUFHLG1CQUFtQixDQUFDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ3JELEtBQUssR0FBRyx3QkFBd0IsQ0FBQyxLQUFLLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztJQUMzRCxNQUFNLE9BQU8sR0FBWSxJQUFJLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNyRSxPQUFPLE9BQU8sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7QUFDL0IsQ0FBQztBQUVELFNBQVMsdUJBQXVCLENBQUMsS0FBYSxFQUFFLGdCQUF3QjtJQUN0RSxNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3BFLE9BQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLElBQUksZ0JBQWdCLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztBQUN4RSxDQUFDO0FBRUQsU0FBUyxtQkFBbUIsQ0FBQyxLQUFhLEVBQUUsZ0JBQXdCO0lBQ2xFLE1BQU0sY0FBYyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdkMsSUFBSSxjQUFjLEtBQUssZ0JBQWdCLEVBQUU7UUFDdkMsT0FBTyxDQUFDLEdBQUcsS0FBSyxDQUFDO0tBQ2xCO0lBRUQsTUFBTSxhQUFhLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3JELElBQUksYUFBYSxLQUFLLGdCQUFnQixFQUFFO1FBQ3RDLE9BQU8sS0FBSyxHQUFHLENBQUMsQ0FBQztLQUNsQjtJQUVELE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELFNBQVMsd0JBQXdCLENBQUMsS0FBYSxFQUFFLGtCQUEwQjtJQUN6RSxPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMsa0JBQWtCLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDL0MsQ0FBQztBQUVELFNBQVMsV0FBVyxDQUFDLENBQWdCO0lBQ25DLE9BQU8sQ0FBQyxDQUFDLE9BQU8sSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDO0FBQ2hDLENBQUM7QUFFRCxTQUFTLFVBQVUsQ0FBQyxDQUFnQjtJQUNsQyxPQUFPLENBQUMsQ0FBQyxHQUFHLElBQUksbUJBQW1CLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ2pELENBQUM7QUFFRCxTQUFTLFdBQVcsQ0FBQyxDQUFnQjtJQUNuQyxNQUFNLEdBQUcsR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDMUIsT0FBTyxJQUFJLE1BQU0sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUN0RCxDQUFDO0FBRUQsU0FBUyxjQUFjLENBQ3JCLENBQWdCLEVBQ2hCLGlCQUEyQjtJQUUzQixNQUFNLGFBQWEsR0FBWSxDQUFDLENBQUMsTUFBMkIsQ0FBQyxLQUFLLENBQUM7SUFDbkUsTUFBTSxjQUFjLEdBQ2pCLENBQUMsQ0FBQyxNQUEyQixDQUFDLGNBQWMsSUFBSSxDQUFDLENBQUM7SUFDckQsTUFBTSxVQUFVLEdBQUcsYUFBYSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMvQyxNQUFNLGVBQWUsR0FBRyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLEVBQUUsRUFBRSxDQUMzRCxhQUFhLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUNsQyxDQUFDO0lBRUYsTUFBTSxzQkFBc0IsR0FBRyxVQUFVLElBQUksY0FBYyxJQUFJLENBQUMsQ0FBQztJQUNqRSxJQUFJLENBQUMsc0JBQXNCLElBQUksQ0FBQyxlQUFlLEVBQUU7UUFDL0Msa0JBQWtCLENBQUMsSUFBSSxDQUFDLEdBQUcsaUJBQWlCLENBQUMsQ0FBQztLQUMvQztJQUVELE1BQU0seUJBQXlCLEdBQUcsaUJBQWlCLENBQUMsSUFBSSxDQUN0RCxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxTQUFTLENBQ3JELENBQUM7SUFFRixJQUFJLENBQUMsVUFBVSxJQUFJLENBQUMseUJBQXlCLElBQUksY0FBYyxLQUFLLENBQUMsRUFBRTtRQUNyRSxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7S0FDOUI7SUFFRCxPQUFPLGtCQUFrQixDQUFDO0FBQzVCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBVTlNJR05FRF9JTlRFR0VSX1JFR0VYID0gJ15bMC05XSokJztcbmNvbnN0IFNJR05FRF9ET1VCTEVfUkVHRVggPSAnXi0/WzAtOV0rKC5bMC05XSspPyQnO1xuY29uc3QgTlVNQkVSU19SRUdFWCA9IC9cXGQvZztcbmNvbnN0IENIUk9NRV9NSU5fVkFMSURBVElPTl9NRVNTQUdFID0gJ1ZhbHVlIG11c3QgYmUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvJztcbmNvbnN0IENIUk9NRV9NQVhfVkFMSURBVElPTl9NRVNTQUdFID0gJ1ZhbHVlIG11c3QgYmUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvJztcbmNvbnN0IGFjdGlvbktleXMgPSBbJ2EnLCAnYycsICd2JywgJ3gnXTtcbmNvbnN0IGRlZmF1bHRBbGxvd2VkS2V5cyA9IFtcbiAgJ0JhY2tzcGFjZScsXG4gICdBcnJvd0xlZnQnLFxuICAnQXJyb3dSaWdodCcsXG4gICdFc2NhcGUnLFxuICAnVGFiJyxcbl07XG5cbmV4cG9ydCBmdW5jdGlvbiBvdmVycmlkZUlucHV0VHlwZShpbnB1dDogSFRNTElucHV0RWxlbWVudCk6IHZvaWQge1xuICAvLyBjaGVja2luZyBuZXcgY2kuXG4gIGlucHV0LnNldEF0dHJpYnV0ZSgndHlwZScsICd0ZXh0Jyk7XG4gIGlucHV0LnNldEF0dHJpYnV0ZSgnaW5wdXRtb2RlJywgJ2RlY2ltYWwnKTtcbiAgaW5wdXQucmVtb3ZlQXR0cmlidXRlKCdwYXR0ZXJuJyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRGb3JtYXR0ZWRWYWx1ZShcbiAgdmFsdWU6IHN0cmluZyxcbiAgZGVjaW1hbFNlcGFyYXRvcjogc3RyaW5nLFxuICB0aG91c2FuZHNTZXBhcmF0b3I6IHN0cmluZ1xuKTogbnVtYmVyIHtcbiAgcmV0dXJuIE51bWJlcihcbiAgICBwYXJzZVZhbHVlKHZhbHVlLCBkZWNpbWFsU2VwYXJhdG9yLCB0aG91c2FuZHNTZXBhcmF0b3IpLnJlcGxhY2UoZGVjaW1hbFNlcGFyYXRvciwgJy4nKVxuICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNBbGxvd2VkS2V5KFxuICBlOiBLZXlib2FyZEV2ZW50LFxuICBkZWNpbWFsU2VwYXJhdG9yczogc3RyaW5nW11cbik6IGJvb2xlYW4ge1xuICBjb25zdCBrZXk6IHN0cmluZyA9IGdldEtleU5hbWUoZSk7XG4gIGNvbnN0IGFsbG93ZWRLZXlzID0gZ2V0QWxsb3dlZEtleXMoZSwgZGVjaW1hbFNlcGFyYXRvcnMpO1xuICByZXR1cm4gKFxuICAgIGFsbG93ZWRLZXlzLmluY2x1ZGVzKGtleSkgfHxcbiAgICAoYWN0aW9uS2V5cy5pbmNsdWRlcyhrZXkpICYmIGlzQWN0aW9uS2V5KGUpKSB8fFxuICAgIGlzTnVtYmVyS2V5KGUpXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZShcbiAgZWw6IEhUTUxJbnB1dEVsZW1lbnQsXG4gIHZhbHVlOiBudW1iZXIsXG4gIG1pbj86IG51bWJlcixcbiAgbWF4PzogbnVtYmVyXG4pOiBib29sZWFuIHtcbiAgaWYgKHZhbHVlIDwgbWluKSB7XG4gICAgZWwuc2V0Q3VzdG9tVmFsaWRpdHkoYCR7Q0hST01FX01JTl9WQUxJREFUSU9OX01FU1NBR0V9ICR7bWlufS5gKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAodmFsdWUgPiBtYXgpIHtcbiAgICBlbC5zZXRDdXN0b21WYWxpZGl0eShgJHtDSFJPTUVfTUFYX1ZBTElEQVRJT05fTUVTU0FHRX0gJHttYXh9LmApO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGVsLnNldEN1c3RvbVZhbGlkaXR5KCcnKTtcbiAgcmV0dXJuIHRydWU7XG59XG5cbi8qKlxuICogc3VwcG9ydCBmb3Igb2xkIGJyb3dzZXJzLlxuICovXG5mdW5jdGlvbiBtYXBLZXlDb2RlVG9LZXlOYW1lKGtleUNvZGU6IG51bWJlcik6IHN0cmluZyB7XG4gIGlmIChrZXlDb2RlICYmIFN0cmluZy5mcm9tQ2hhckNvZGUpIHtcbiAgICBzd2l0Y2ggKGtleUNvZGUpIHtcbiAgICAgIGNhc2UgODpcbiAgICAgICAgcmV0dXJuICdCYWNrc3BhY2UnO1xuICAgICAgY2FzZSA5OlxuICAgICAgICByZXR1cm4gJ1RhYic7XG4gICAgICBjYXNlIDI3OlxuICAgICAgICByZXR1cm4gJ0VzY2FwZSc7XG4gICAgICBjYXNlIDM3OlxuICAgICAgICByZXR1cm4gJ0Fycm93TGVmdCc7XG4gICAgICBjYXNlIDM5OlxuICAgICAgICByZXR1cm4gJ0Fycm93UmlnaHQnO1xuICAgICAgY2FzZSAxODg6XG4gICAgICAgIHJldHVybiAnLCc7XG4gICAgICBjYXNlIDE5MDpcbiAgICAgICAgcmV0dXJuICcuJztcbiAgICAgIGNhc2UgMTA5OlxuICAgICAgY2FzZSAxNzM6XG4gICAgICBjYXNlIDE4OTpcbiAgICAgICAgcmV0dXJuICctJztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGtleUNvZGUpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gJyc7XG59XG5cbmZ1bmN0aW9uIHBhcnNlVmFsdWUodmFsdWU6IHN0cmluZywgZGVjaW1hbFNlcGFyYXRvcjogc3RyaW5nLCB0aG91c2FuZFNlcGFyYXRvcjogc3RyaW5nKTogc3RyaW5nIHtcbiAgdmFsdWUgPSByZXBsYWNlRGVjaW1hbFNlcGFyYXRvcih2YWx1ZSwgZGVjaW1hbFNlcGFyYXRvcik7XG4gIHZhbHVlID0gYXBwZW5kWmVyb1RvRGVjaW1hbCh2YWx1ZSwgZGVjaW1hbFNlcGFyYXRvcik7XG4gIHZhbHVlID0gcmVtb3ZlVGhvdXNhbmRzU2VwYXJhdG9yKHZhbHVlLCB0aG91c2FuZFNlcGFyYXRvcik7XG4gIGNvbnN0IGlzVmFsaWQ6IGJvb2xlYW4gPSBuZXcgUmVnRXhwKFNJR05FRF9ET1VCTEVfUkVHRVgpLnRlc3QodmFsdWUpO1xuICByZXR1cm4gaXNWYWxpZCA/IHZhbHVlIDogJzAnO1xufVxuXG5mdW5jdGlvbiByZXBsYWNlRGVjaW1hbFNlcGFyYXRvcih2YWx1ZTogc3RyaW5nLCBkZWNpbWFsU2VwYXJhdG9yOiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCBzZXBhcmF0b3IgPSB2YWx1ZS5yZXBsYWNlKCctJywgJycpLnJlcGxhY2UoTlVNQkVSU19SRUdFWCwgJycpO1xuICByZXR1cm4gdmFsdWUucmVwbGFjZShzZXBhcmF0b3IgfHwgZGVjaW1hbFNlcGFyYXRvciwgZGVjaW1hbFNlcGFyYXRvcik7XG59XG5cbmZ1bmN0aW9uIGFwcGVuZFplcm9Ub0RlY2ltYWwodmFsdWU6IHN0cmluZywgZGVjaW1hbFNlcGFyYXRvcjogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3QgZmlyc3RDaGFyYWN0ZXIgPSB2YWx1ZS5jaGFyQXQoMCk7XG4gIGlmIChmaXJzdENoYXJhY3RlciA9PT0gZGVjaW1hbFNlcGFyYXRvcikge1xuICAgIHJldHVybiAwICsgdmFsdWU7XG4gIH1cblxuICBjb25zdCBsYXN0Q2hhcmFjdGVyID0gdmFsdWUuY2hhckF0KHZhbHVlLmxlbmd0aCAtIDEpO1xuICBpZiAobGFzdENoYXJhY3RlciA9PT0gZGVjaW1hbFNlcGFyYXRvcikge1xuICAgIHJldHVybiB2YWx1ZSArIDA7XG4gIH1cblxuICByZXR1cm4gdmFsdWU7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZVRob3VzYW5kc1NlcGFyYXRvcih2YWx1ZTogc3RyaW5nLCB0aG91c2FuZHNTZXBhcmF0b3I6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiB2YWx1ZS5yZXBsYWNlKHRob3VzYW5kc1NlcGFyYXRvciwgJycpO1xufVxuXG5mdW5jdGlvbiBpc0FjdGlvbktleShlOiBLZXlib2FyZEV2ZW50KTogYm9vbGVhbiB7XG4gIHJldHVybiBlLmN0cmxLZXkgfHwgZS5tZXRhS2V5O1xufVxuXG5mdW5jdGlvbiBnZXRLZXlOYW1lKGU6IEtleWJvYXJkRXZlbnQpOiBzdHJpbmcge1xuICByZXR1cm4gZS5rZXkgfHwgbWFwS2V5Q29kZVRvS2V5TmFtZShlLmtleUNvZGUpO1xufVxuXG5mdW5jdGlvbiBpc051bWJlcktleShlOiBLZXlib2FyZEV2ZW50KTogYm9vbGVhbiB7XG4gIGNvbnN0IGtleSA9IGdldEtleU5hbWUoZSk7XG4gIHJldHVybiBuZXcgUmVnRXhwKFVOU0lHTkVEX0lOVEVHRVJfUkVHRVgpLnRlc3Qoa2V5KTtcbn1cblxuZnVuY3Rpb24gZ2V0QWxsb3dlZEtleXMoXG4gIGU6IEtleWJvYXJkRXZlbnQsXG4gIGRlY2ltYWxTZXBhcmF0b3JzOiBzdHJpbmdbXVxuKTogc3RyaW5nW10ge1xuICBjb25zdCBvcmlnaW5hbFZhbHVlOiBzdHJpbmcgPSAoZS50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWU7XG4gIGNvbnN0IGN1cnNvclBvc2l0aW9uOiBudW1iZXIgPVxuICAgIChlLnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50KS5zZWxlY3Rpb25TdGFydCB8fCAwO1xuICBjb25zdCBzaWduRXhpc3RzID0gb3JpZ2luYWxWYWx1ZS5pbmNsdWRlcygnLScpO1xuICBjb25zdCBzZXBhcmF0b3JFeGlzdHMgPSBkZWNpbWFsU2VwYXJhdG9ycy5zb21lKChzZXBhcmF0b3IpID0+XG4gICAgb3JpZ2luYWxWYWx1ZS5pbmNsdWRlcyhzZXBhcmF0b3IpXG4gICk7XG5cbiAgY29uc3Qgc2VwYXJhdG9ySXNDbG9zZVRvU2lnbiA9IHNpZ25FeGlzdHMgJiYgY3Vyc29yUG9zaXRpb24gPD0gMTtcbiAgaWYgKCFzZXBhcmF0b3JJc0Nsb3NlVG9TaWduICYmICFzZXBhcmF0b3JFeGlzdHMpIHtcbiAgICBkZWZhdWx0QWxsb3dlZEtleXMucHVzaCguLi5kZWNpbWFsU2VwYXJhdG9ycyk7XG4gIH1cblxuICBjb25zdCBmaXJzdENoYXJhY3RlcklzU2VwYXJhdG9yID0gZGVjaW1hbFNlcGFyYXRvcnMuc29tZShcbiAgICAoc2VwYXJhdG9yKSA9PiBvcmlnaW5hbFZhbHVlLmNoYXJBdCgwKSA9PT0gc2VwYXJhdG9yXG4gICk7XG5cbiAgaWYgKCFzaWduRXhpc3RzICYmICFmaXJzdENoYXJhY3RlcklzU2VwYXJhdG9yICYmIGN1cnNvclBvc2l0aW9uID09PSAwKSB7XG4gICAgZGVmYXVsdEFsbG93ZWRLZXlzLnB1c2goJy0nKTtcbiAgfVxuXG4gIHJldHVybiBkZWZhdWx0QWxsb3dlZEtleXM7XG59XG4iXX0=