const UNSIGNED_INTEGER_REGEX = '^[0-9]*$';
const SIGNED_DOUBLE_REGEX = '^-?[0-9]+(.[0-9]+)?$';
const NUMBERS_REGEX = /\d/g;
const CHROME_MIN_VALIDATION_MESSAGE = 'Value must be greater than or equal to';
const CHROME_MAX_VALIDATION_MESSAGE = 'Value must be less than or equal to';
const DEFAULT_NUMERIC_VALUE = 0;
const DEFAULT_ACTION_KEYS = ['a', 'c', 'v', 'x'];
const DEFAULT_ALLOWED_KEYS = [
    'Backspace',
    'ArrowLeft',
    'ArrowRight',
    'Escape',
    'Tab',
];
/**
 * Override input attributes for validation and mobile support.
 * @param input - input element
 */
export function overrideInputType(input) {
    input.setAttribute('type', 'text');
    input.setAttribute('inputmode', 'decimal');
    input.removeAttribute('pattern');
}
/**
 * Get formatted value, if the value is a valid numeric value it will be formatted if not a default value will be returned.
 * @param value - value to format.
 * @param decimalSeparator - decimal separator to replace (if needed).
 * @param thousandsSeparator - thousands separator to remove (if needed).
 */
export function getFormattedValue(value, decimalSeparator, thousandsSeparator) {
    const formatted = Number(parseValue(value, decimalSeparator, thousandsSeparator).replace(decimalSeparator, '.'));
    return isNaN(formatted) ? DEFAULT_NUMERIC_VALUE : formatted;
}
/**
 * Check if the pressed key is allowed in the numeric input field.
 * @param e - keyboard event.
 * @param decimalSeparators - array of supported separators.
 */
export function isAllowedKey(e, decimalSeparators) {
    const key = getKeyName(e);
    const allowedKeys = getAllowedKeys(e, decimalSeparators);
    return (allowedKeys.includes(key) ||
        (DEFAULT_ACTION_KEYS.includes(key) && isActionKey(e)) ||
        isNumberKey(e));
}
/**
 * Align all browsers to validate as same as Chrome browser does.
 * Validation will be after the field loose focus and with Chrome default messages.
 * @param el - input element.
 * @param value - input value.
 * @param min - minimum valid value.
 * @param max - maximum valid value.
 */
export function validate(el, value, min, max) {
    if (value < min) {
        el.setCustomValidity(`${CHROME_MIN_VALIDATION_MESSAGE} ${min}.`);
        return false;
    }
    if (value > max) {
        el.setCustomValidity(`${CHROME_MAX_VALIDATION_MESSAGE} ${max}.`);
        return false;
    }
    el.setCustomValidity('');
    return true;
}
/**
 * support for old browsers.
 */
function mapKeyCodeToKeyName(keyCode) {
    if (keyCode && String.fromCharCode) {
        switch (keyCode) {
            case 8:
                return 'Backspace';
            case 9:
                return 'Tab';
            case 27:
                return 'Escape';
            case 37:
                return 'ArrowLeft';
            case 39:
                return 'ArrowRight';
            case 188:
                return ',';
            case 190:
                return '.';
            case 109:
            case 173:
            case 189:
                return '-';
            default:
                return String.fromCharCode(keyCode);
        }
    }
    return '';
}
/**
 * Add zero to decimal values, replaces the decimal separator and remove the thousand separator.
 * If the value is a numeric value the parsed value will be returned, if not - the default numeric value.
 * @param value - value to parse.
 * @param decimalSeparator - decimal separator to replace (if needed).
 * @param thousandsSeparator - thousands separator to remove (if needed).
 */
function parseValue(value, decimalSeparator, thousandSeparator) {
    value = replaceDecimalSeparator(value, decimalSeparator);
    value = appendZeroToDecimal(value, decimalSeparator);
    value = removeThousandsSeparator(value, thousandSeparator);
    const isValid = new RegExp(SIGNED_DOUBLE_REGEX).test(value);
    return isValid ? value : DEFAULT_NUMERIC_VALUE.toString();
}
function replaceDecimalSeparator(value, decimalSeparator) {
    const separator = value.replace('-', '').replace(NUMBERS_REGEX, '');
    return value.replace(separator || decimalSeparator, decimalSeparator);
}
function appendZeroToDecimal(value, decimalSeparator) {
    const firstCharacter = value.charAt(0);
    if (firstCharacter === decimalSeparator) {
        return 0 + value;
    }
    const lastCharacter = value.charAt(value.length - 1);
    if (lastCharacter === decimalSeparator) {
        return value + 0;
    }
    return value;
}
function removeThousandsSeparator(value, thousandsSeparator) {
    return value.replace(thousandsSeparator, '');
}
function isActionKey(e) {
    return e.ctrlKey || e.metaKey;
}
function getKeyName(e) {
    return e.key || mapKeyCodeToKeyName(e.keyCode);
}
function isNumberKey(e) {
    const key = getKeyName(e);
    return new RegExp(UNSIGNED_INTEGER_REGEX).test(key);
}
function getAllowedKeys(e, decimalSeparators) {
    const allowedKeys = [...DEFAULT_ALLOWED_KEYS];
    const originalValue = e.target.value;
    const cursorPosition = e.target.selectionStart || 0;
    const signExists = originalValue.includes('-');
    const separatorExists = decimalSeparators.some((separator) => originalValue.includes(separator));
    const separatorIsCloseToSign = signExists && cursorPosition <= 1;
    if (!separatorIsCloseToSign && !separatorExists) {
        allowedKeys.push(...decimalSeparators);
    }
    const firstCharacterIsSeparator = decimalSeparators.some((separator) => originalValue.charAt(0) === separator);
    if (!signExists && !firstCharacterIsSeparator && cursorPosition === 0) {
        allowedKeys.push('-');
    }
    return allowedKeys;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibnVtZXJpYy1pbnB1dC51dGlscy5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS90cmF2aXMvYnVpbGQvRGFuaWVsaXZlcmFudC9uZy1kbC9wcm9qZWN0cy9udW1lcmljLWlucHV0L3NyYy8iLCJzb3VyY2VzIjpbImxpYi9udW1lcmljLWlucHV0LnV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sc0JBQXNCLEdBQUcsVUFBVSxDQUFDO0FBQzFDLE1BQU0sbUJBQW1CLEdBQUcsc0JBQXNCLENBQUM7QUFDbkQsTUFBTSxhQUFhLEdBQUcsS0FBSyxDQUFDO0FBQzVCLE1BQU0sNkJBQTZCLEdBQUcsd0NBQXdDLENBQUM7QUFDL0UsTUFBTSw2QkFBNkIsR0FBRyxxQ0FBcUMsQ0FBQztBQUM1RSxNQUFNLHFCQUFxQixHQUFHLENBQUMsQ0FBQztBQUNoQyxNQUFNLG1CQUFtQixHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7QUFDakQsTUFBTSxvQkFBb0IsR0FBRztJQUMzQixXQUFXO0lBQ1gsV0FBVztJQUNYLFlBQVk7SUFDWixRQUFRO0lBQ1IsS0FBSztDQUNOLENBQUM7QUFFRjs7O0dBR0c7QUFDSCxNQUFNLFVBQVUsaUJBQWlCLENBQUMsS0FBdUI7SUFDdkQsS0FBSyxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDbkMsS0FBSyxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDM0MsS0FBSyxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUNuQyxDQUFDO0FBRUQ7Ozs7O0dBS0c7QUFDSCxNQUFNLFVBQVUsaUJBQWlCLENBQy9CLEtBQWEsRUFDYixnQkFBd0IsRUFDeEIsa0JBQTBCO0lBRTFCLE1BQU0sU0FBUyxHQUFHLE1BQU0sQ0FDdEIsVUFBVSxDQUFDLEtBQUssRUFBRSxnQkFBZ0IsRUFBRSxrQkFBa0IsQ0FBQyxDQUFD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VEVHRVJfUkVHRVggPSAnXlswLTldKiQnO1xuY29uc3QgU0lHTkVEX0RPVUJMRV9SRUdFWCA9ICdeLT9bMC05XSsoLlswLTldKyk/JCc7XG5jb25zdCBOVU1CRVJTX1JFR0VYID0gL1xcZC9nO1xuY29uc3QgQ0hST01FX01JTl9WQUxJREFUSU9OX01FU1NBR0UgPSAnVmFsdWUgbXVzdCBiZSBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8nO1xuY29uc3QgQ0hST01FX01BWF9WQUxJREFUSU9OX01FU1NBR0UgPSAnVmFsdWUgbXVzdCBiZSBsZXNzIHRoYW4gb3IgZXF1YWwgdG8nO1xuY29uc3QgREVGQVVMVF9OVU1FUklDX1ZBTFVFID0gMDtcbmNvbnN0IERFRkFVTFRfQUNUSU9OX0tFWVMgPSBbJ2EnLCAnYycsICd2JywgJ3gnXTtcbmNvbnN0IERFRkFVTFRfQUxMT1dFRF9LRVlTID0gW1xuICAnQmFja3NwYWNlJyxcbiAgJ0Fycm93TGVmdCcsXG4gICdBcnJvd1JpZ2h0JyxcbiAgJ0VzY2FwZScsXG4gICdUYWInLFxuXTtcblxuLyoqXG4gKiBPdmVycmlkZSBpbnB1dCBhdHRyaWJ1dGVzIGZvciB2YWxpZGF0aW9uIGFuZCBtb2JpbGUgc3VwcG9ydC5cbiAqIEBwYXJhbSBpbnB1dCAtIGlucHV0IGVsZW1lbnRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG92ZXJyaWRlSW5wdXRUeXBlKGlucHV0OiBIVE1MSW5wdXRFbGVtZW50KTogdm9pZCB7XG4gIGlucHV0LnNldEF0dHJpYnV0ZSgndHlwZScsICd0ZXh0Jyk7XG4gIGlucHV0LnNldEF0dHJpYnV0ZSgnaW5wdXRtb2RlJywgJ2RlY2ltYWwnKTtcbiAgaW5wdXQucmVtb3ZlQXR0cmlidXRlKCdwYXR0ZXJuJyk7XG59XG5cbi8qKlxuICogR2V0IGZvcm1hdHRlZCB2YWx1ZSwgaWYgdGhlIHZhbHVlIGlzIGEgdmFsaWQgbnVtZXJpYyB2YWx1ZSBpdCB3aWxsIGJlIGZvcm1hdHRlZCBpZiBub3QgYSBkZWZhdWx0IHZhbHVlIHdpbGwgYmUgcmV0dXJuZWQuXG4gKiBAcGFyYW0gdmFsdWUgLSB2YWx1ZSB0byBmb3JtYXQuXG4gKiBAcGFyYW0gZGVjaW1hbFNlcGFyYXRvciAtIGRlY2ltYWwgc2VwYXJhdG9yIHRvIHJlcGxhY2UgKGlmIG5lZWRlZCkuXG4gKiBAcGFyYW0gdGhvdXNhbmRzU2VwYXJhdG9yIC0gdGhvdXNhbmRzIHNlcGFyYXRvciB0byByZW1vdmUgKGlmIG5lZWRlZCkuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRGb3JtYXR0ZWRWYWx1ZShcbiAgdmFsdWU6IHN0cmluZyxcbiAgZGVjaW1hbFNlcGFyYXRvcjogc3RyaW5nLFxuICB0aG91c2FuZHNTZXBhcmF0b3I6IHN0cmluZ1xuKTogbnVtYmVyIHtcbiAgY29uc3QgZm9ybWF0dGVkID0gTnVtYmVyKFxuICAgIHBhcnNlVmFsdWUodmFsdWUsIGRlY2ltYWxTZXBhcmF0b3IsIHRob3VzYW5kc1NlcGFyYXRvcikucmVwbGFjZShkZWNpbWFsU2VwYXJhdG9yLCAnLicpXG4gICk7XG4gIHJldHVybiBpc05hTihmb3JtYXR0ZWQpID8gREVGQVVMVF9OVU1FUklDX1ZBTFVFIDogZm9ybWF0dGVkO1xufVxuXG4vKipcbiAqIENoZWNrIGlmIHRoZSBwcmVzc2VkIGtleSBpcyBhbGxvd2VkIGluIHRoZSBudW1lcmljIGlucHV0IGZpZWxkLlxuICogQHBhcmFtIGUgLSBrZXlib2FyZCBldmVudC5cbiAqIEBwYXJhbSBkZWNpbWFsU2VwYXJhdG9ycyAtIGFycmF5IG9mIHN1cHBvcnRlZCBzZXBhcmF0b3JzLlxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNBbGxvd2VkS2V5KFxuICBlOiBLZXlib2FyZEV2ZW50LFxuICBkZWNpbWFsU2VwYXJhdG9yczogc3RyaW5nW11cbik6IGJvb2xlYW4ge1xuICBjb25zdCBrZXk6IHN0cmluZyA9IGdldEtleU5hbWUoZSk7XG4gIGNvbnN0IGFsbG93ZWRLZXlzID0gZ2V0QWxsb3dlZEtleXMoZSwgZGVjaW1hbFNlcGFyYXRvcnMpO1xuICByZXR1cm4gKFxuICAgIGFsbG93ZWRLZXlzLmluY2x1ZGVzKGtleSkgfHxcbiAgICAoREVGQVVMVF9BQ1RJT05fS0VZUy5pbmNsdWRlcyhrZXkpICYmIGlzQWN0aW9uS2V5KGUpKSB8fFxuICAgIGlzTnVtYmVyS2V5KGUpXG4gICk7XG59XG5cbi8qKlxuICogQWxpZ24gYWxsIGJyb3dzZXJzIHRvIHZhbGlkYXRlIGFzIHNhbWUgYXMgQ2hyb21lIGJyb3dzZXIgZG9lcy5cbiAqIFZhbGlkYXRpb24gd2lsbCBiZSBhZnRlciB0aGUgZmllbGQgbG9vc2UgZm9jdXMgYW5kIHdpdGggQ2hyb21lIGRlZmF1bHQgbWVzc2FnZXMuXG4gKiBAcGFyYW0gZWwgLSBpbnB1dCBlbGVtZW50LlxuICogQHBhcmFtIHZhbHVlIC0gaW5wdXQgdmFsdWUuXG4gKiBAcGFyYW0gbWluIC0gbWluaW11bSB2YWxpZCB2YWx1ZS5cbiAqIEBwYXJhbSBtYXggLSBtYXhpbXVtIHZhbGlkIHZhbHVlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGUoXG4gIGVsOiBIVE1MSW5wdXRFbGVtZW50LFxuICB2YWx1ZTogbnVtYmVyLFxuICBtaW4/OiBudW1iZXIsXG4gIG1heD86IG51bWJlclxuKTogYm9vbGVhbiB7XG4gIGlmICh2YWx1ZSA8IG1pbikge1xuICAgIGVsLnNldEN1c3RvbVZhbGlkaXR5KGAke0NIUk9NRV9NSU5fVkFMSURBVElPTl9NRVNTQUdFfSAke21pbn0uYCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaWYgKHZhbHVlID4gbWF4KSB7XG4gICAgZWwuc2V0Q3VzdG9tVmFsaWRpdHkoYCR7Q0hST01FX01BWF9WQUxJREFUSU9OX01FU1NBR0V9ICR7bWF4fS5gKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBlbC5zZXRDdXN0b21WYWxpZGl0eSgnJyk7XG4gIHJldHVybiB0cnVlO1xufVxuXG4vKipcbiAqIHN1cHBvcnQgZm9yIG9sZCBicm93c2Vycy5cbiAqL1xuZnVuY3Rpb24gbWFwS2V5Q29kZVRvS2V5TmFtZShrZXlDb2RlOiBudW1iZXIpOiBzdHJpbmcge1xuICBpZiAoa2V5Q29kZSAmJiBTdHJpbmcuZnJvbUNoYXJDb2RlKSB7XG4gICAgc3dpdGNoIChrZXlDb2RlKSB7XG4gICAgICBjYXNlIDg6XG4gICAgICAgIHJldHVybiAnQmFja3NwYWNlJztcbiAgICAgIGNhc2UgOTpcbiAgICAgICAgcmV0dXJuICdUYWInO1xuICAgICAgY2FzZSAyNzpcbiAgICAgICAgcmV0dXJuICdFc2NhcGUnO1xuICAgICAgY2FzZSAzNzpcbiAgICAgICAgcmV0dXJuICdBcnJvd0xlZnQnO1xuICAgICAgY2FzZSAzOTpcbiAgICAgICAgcmV0dXJuICdBcnJvd1JpZ2h0JztcbiAgICAgIGNhc2UgMTg4OlxuICAgICAgICByZXR1cm4gJywnO1xuICAgICAgY2FzZSAxOTA6XG4gICAgICAgIHJldHVybiAnLic7XG4gICAgICBjYXNlIDEwOTpcbiAgICAgIGNhc2UgMTczOlxuICAgICAgY2FzZSAxODk6XG4gICAgICAgIHJldHVybiAnLSc7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShrZXlDb2RlKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuICcnO1xufVxuXG4vKipcbiAqIEFkZCB6ZXJvIHRvIGRlY2ltYWwgdmFsdWVzLCByZXBsYWNlcyB0aGUgZGVjaW1hbCBzZXBhcmF0b3IgYW5kIHJlbW92ZSB0aGUgdGhvdXNhbmQgc2VwYXJhdG9yLlxuICogSWYgdGhlIHZhbHVlIGlzIGEgbnVtZXJpYyB2YWx1ZSB0aGUgcGFyc2VkIHZhbHVlIHdpbGwgYmUgcmV0dXJuZWQsIGlmIG5vdCAtIHRoZSBkZWZhdWx0IG51bWVyaWMgdmFsdWUuXG4gKiBAcGFyYW0gdmFsdWUgLSB2YWx1ZSB0byBwYXJzZS5cbiAqIEBwYXJhbSBkZWNpbWFsU2VwYXJhdG9yIC0gZGVjaW1hbCBzZXBhcmF0b3IgdG8gcmVwbGFjZSAoaWYgbmVlZGVkKS5cbiAqIEBwYXJhbSB0aG91c2FuZHNTZXBhcmF0b3IgLSB0aG91c2FuZHMgc2VwYXJhdG9yIHRvIHJlbW92ZSAoaWYgbmVlZGVkKS5cbiAqL1xuZnVuY3Rpb24gcGFyc2VWYWx1ZSh2YWx1ZTogc3RyaW5nLCBkZWNpbWFsU2VwYXJhdG9yOiBzdHJpbmcsIHRob3VzYW5kU2VwYXJhdG9yOiBzdHJpbmcpOiBzdHJpbmcge1xuICB2YWx1ZSA9IHJlcGxhY2VEZWNpbWFsU2VwYXJhdG9yKHZhbHVlLCBkZWNpbWFsU2VwYXJhdG9yKTtcbiAgdmFsdWUgPSBhcHBlbmRaZXJvVG9EZWNpbWFsKHZhbHVlLCBkZWNpbWFsU2VwYXJhdG9yKTtcbiAgdmFsdWUgPSByZW1vdmVUaG91c2FuZHNTZXBhcmF0b3IodmFsdWUsIHRob3VzYW5kU2VwYXJhdG9yKTtcbiAgY29uc3QgaXNWYWxpZDogYm9vbGVhbiA9IG5ldyBSZWdFeHAoU0lHTkVEX0RPVUJMRV9SRUdFWCkudGVzdCh2YWx1ZSk7XG4gIHJldHVybiBpc1ZhbGlkID8gdmFsdWUgOiBERUZBVUxUX05VTUVSSUNfVkFMVUUudG9TdHJpbmcoKTtcbn1cblxuZnVuY3Rpb24gcmVwbGFjZURlY2ltYWxTZXBhcmF0b3IodmFsdWU6IHN0cmluZywgZGVjaW1hbFNlcGFyYXRvcjogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3Qgc2VwYXJhdG9yID0gdmFsdWUucmVwbGFjZSgnLScsICcnKS5yZXBsYWNlKE5VTUJFUlNfUkVHRVgsICcnKTtcbiAgcmV0dXJuIHZhbHVlLnJlcGxhY2Uoc2VwYXJhdG9yIHx8IGRlY2ltYWxTZXBhcmF0b3IsIGRlY2ltYWxTZXBhcmF0b3IpO1xufVxuXG5mdW5jdGlvbiBhcHBlbmRaZXJvVG9EZWNpbWFsKHZhbHVlOiBzdHJpbmcsIGRlY2ltYWxTZXBhcmF0b3I6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IGZpcnN0Q2hhcmFjdGVyID0gdmFsdWUuY2hhckF0KDApO1xuICBpZiAoZmlyc3RDaGFyYWN0ZXIgPT09IGRlY2ltYWxTZXBhcmF0b3IpIHtcbiAgICByZXR1cm4gMCArIHZhbHVlO1xuICB9XG5cbiAgY29uc3QgbGFzdENoYXJhY3RlciA9IHZhbHVlLmNoYXJBdCh2YWx1ZS5sZW5ndGggLSAxKTtcbiAgaWYgKGxhc3RDaGFyYWN0ZXIgPT09IGRlY2ltYWxTZXBhcmF0b3IpIHtcbiAgICByZXR1cm4gdmFsdWUgKyAwO1xuICB9XG5cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG5mdW5jdGlvbiByZW1vdmVUaG91c2FuZHNTZXBhcmF0b3IodmFsdWU6IHN0cmluZywgdGhvdXNhbmRzU2VwYXJhdG9yOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gdmFsdWUucmVwbGFjZSh0aG91c2FuZHNTZXBhcmF0b3IsICcnKTtcbn1cblxuZnVuY3Rpb24gaXNBY3Rpb25LZXkoZTogS2V5Ym9hcmRFdmVudCk6IGJvb2xlYW4ge1xuICByZXR1cm4gZS5jdHJsS2V5IHx8IGUubWV0YUtleTtcbn1cblxuZnVuY3Rpb24gZ2V0S2V5TmFtZShlOiBLZXlib2FyZEV2ZW50KTogc3RyaW5nIHtcbiAgcmV0dXJuIGUua2V5IHx8IG1hcEtleUNvZGVUb0tleU5hbWUoZS5rZXlDb2RlKTtcbn1cblxuZnVuY3Rpb24gaXNOdW1iZXJLZXkoZTogS2V5Ym9hcmRFdmVudCk6IGJvb2xlYW4ge1xuICBjb25zdCBrZXkgPSBnZXRLZXlOYW1lKGUpO1xuICByZXR1cm4gbmV3IFJlZ0V4cChVTlNJR05FRF9JTlRFR0VSX1JFR0VYKS50ZXN0KGtleSk7XG59XG5cbmZ1bmN0aW9uIGdldEFsbG93ZWRLZXlzKFxuICBlOiBLZXlib2FyZEV2ZW50LFxuICBkZWNpbWFsU2VwYXJhdG9yczogc3RyaW5nW11cbik6IHN0cmluZ1tdIHtcbiAgY29uc3QgYWxsb3dlZEtleXMgPSBbLi4uREVGQVVMVF9BTExPV0VEX0tFWVNdO1xuICBjb25zdCBvcmlnaW5hbFZhbHVlOiBzdHJpbmcgPSAoZS50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWU7XG4gIGNvbnN0IGN1cnNvclBvc2l0aW9uOiBudW1iZXIgPVxuICAgIChlLnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50KS5zZWxlY3Rpb25TdGFydCB8fCAwO1xuICBjb25zdCBzaWduRXhpc3RzID0gb3JpZ2luYWxWYWx1ZS5pbmNsdWRlcygnLScpO1xuICBjb25zdCBzZXBhcmF0b3JFeGlzdHMgPSBkZWNpbWFsU2VwYXJhdG9ycy5zb21lKChzZXBhcmF0b3IpID0+XG4gICAgb3JpZ2luYWxWYWx1ZS5pbmNsdWRlcyhzZXBhcmF0b3IpXG4gICk7XG5cbiAgY29uc3Qgc2VwYXJhdG9ySXNDbG9zZVRvU2lnbiA9IHNpZ25FeGlzdHMgJiYgY3Vyc29yUG9zaXRpb24gPD0gMTtcbiAgaWYgKCFzZXBhcmF0b3JJc0Nsb3NlVG9TaWduICYmICFzZXBhcmF0b3JFeGlzdHMpIHtcbiAgICBhbGxvd2VkS2V5cy5wdXNoKC4uLmRlY2ltYWxTZXBhcmF0b3JzKTtcbiAgfVxuXG4gIGNvbnN0IGZpcnN0Q2hhcmFjdGVySXNTZXBhcmF0b3IgPSBkZWNpbWFsU2VwYXJhdG9ycy5zb21lKFxuICAgIChzZXBhcmF0b3IpID0+IG9yaWdpbmFsVmFsdWUuY2hhckF0KDApID09PSBzZXBhcmF0b3JcbiAgKTtcblxuICBpZiAoIXNpZ25FeGlzdHMgJiYgIWZpcnN0Q2hhcmFjdGVySXNTZXBhcmF0b3IgJiYgY3Vyc29yUG9zaXRpb24gPT09IDApIHtcbiAgICBhbGxvd2VkS2V5cy5wdXNoKCctJyk7XG4gIH1cblxuICByZXR1cm4gYWxsb3dlZEtleXM7XG59XG4iXX0=